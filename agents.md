# Agents / Архитектура проекта Slither Server

## Общая структура
- **index.html**  
  Клиентская часть (игровой интерфейс, логика отображения, взаимодействие через WebSocket).

- **src/**  
  Серверная логика:
    - **server.js** – основной сервер WebSocket, обработка подключений клиентов, синхронизация состояния игры.
    - **world.js** – игровой мир: хранение всех объектов (змеи, еда, события).
    - **spatial.js** – пространственная индексация для оптимизации поиска объектов (например, коллизий, ближайших игроков, еды).
    - **protocol.js** – сетевой протокол: сериализация и десериализация сообщений клиент ↔ сервер.
    - **logger.js** – логирование действий (смерти, убийства и т.п.) в `kills.log`.

- **kills.log**  
  Журнал событий (убийств, столкновений, игровых сессий).

- **package.json / yarn.lock**  
  Зависимости проекта и точные версии пакетов.

## Используемые агенты/библиотеки
- **ws** – WebSocket сервер для реального времени.
- **pg / pg-pool / pg-protocol** – работа с PostgreSQL (хранение статистики, результатов игр).
- **uuid** – генерация уникальных идентификаторов игроков и сущностей.
- **split2** – стриминг логов.
- **pg-cloudflare** – поддержка Postgres в окружении Cloudflare (опционально).

## Логика агентов
- **Игрок (Client Agent)**  
  Работает в браузере (`index.html`). Передаёт действия (движение, ускорение) и получает обновления состояния мира от сервера.

- **Game Server Agent (`server.js`)**  
  Получает события от клиентов, обновляет состояние мира (`world.js`), проверяет коллизии, рассылает обновлённые данные всем подключённым игрокам.

- **World Agent (`world.js`)**  
  Управляет всеми сущностями: змеями, едой, обрабатывает спавн, смерть, перераспределение ресурсов.

- **Spatial Agent (`spatial.js`)**  
  Следит за пространственным расположением объектов для быстрого поиска и минимизации нагрузки (quad-tree или grid-оптимизация).

- **Protocol Agent (`protocol.js`)**  
  Обеспечивает единый формат сообщений (пакетов) между сервером и клиентом.

- **Logger Agent (`logger.js`)**  
  Записывает все важные игровые события в `kills.log`, может использоваться для аналитики или системы рейтингов.

---

## Взаимодействие
1. Игрок подключается к серверу (WebSocket).
2. Сервер создаёт объект змеи, помещает его в мир.
3. Игрок управляет движением, клиент передаёт команды.
4. Сервер через `spatial.js` проверяет коллизии, обновляет мир.
5. Все изменения отдаются клиентам через протокол (`protocol.js`).
6. События смерти/убийств пишутся в `kills.log`.
7. При необходимости статистика уходит в PostgreSQL.

---

